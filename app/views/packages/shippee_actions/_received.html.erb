<% if @package.shipping_estimate_confirmed %>
  <% if @package.shipping_estimate.nil? %>
    The shipper is ready to send the package to you! First, verify the updated package dimensions and photos.<br />
    Then, choose a shipping option from the list below:<br />

    <%= form_tag package_path + '/shippee_action' do %>
      <%= select_tag :shipping_class, options_for_select(flash[:estimates].map { |type, cost|
            [Package::SHIPPING_CLASSES[type] + ': ' + number_to_currency(cost), type]
          }.reverse) %>

      <div class="buttons">
        <button type="submit" name="submit" value="submit" class="btn btn-primary">Submit</button>
      </div>
    <% end %>
  <% else %>
    The total cost of the shipment comes to: <strong><%= number_to_currency @package.shipping_estimate %></strong>.<br />
    The shipper will be able to send the package to you once your payment is received.<br />
    If you have any concerns about the accuracy of the shipping cost, please contact us at
    <%= link_to 'hello@ohship.me', 'mailto:hello@ohship.me' %>.<br />
    <br />
    <em>We are <strong>pre-authorizing</strong> 50% more, for a total of <%= number_to_currency @package.shipping_estimate*1.5 %>, in case any additional charges are incurred.<br />
    You will only actually be charged for the true cost of shipping once the shipper has sent the package.</em>

    <%= form_tag package_path + '/shippee_action' do %>
      <script
        src="https://checkout.stripe.com/v2/checkout.js" class="stripe-button"
        data-key="pk_test_xhOGDSqkhDTfzW7RqeQ3TFlv"
        data-amount="<%= (@package.shipping_estimate_cents*3+1)/2 %>"
        data-name="ohship.me"
        data-description="Shipping for <%= @package.description %>">
      </script>

      <% # TODO: STYLE STRIPE BUTTON; ADD BACK BUTTON HERE %>
    <% end %>
  <% end %>
<% else %>
  The shipper has received the package! We will notify you when it is ready to be shipped to you.
<% end %>
