ready = ->
  adjustDimensions = ->
    $('.section.expanded').css('width', $(window).width())
    #$('.section.expanded').first().css('height', $(window).height()*(1/2))

  $(window).resize adjustDimensions
  adjustDimensions()

  findSectionById = (id) ->
    $(".navbar a[href='##{id}']")

  $('a').click (e) ->
    target = $(e.target)
    target = target.parent() if e.target.tagName != 'A'
    return if !e.target? || target.attr('href')[0] != '#'
    if (target = $("#{target.attr('href')}")).length
      $('html, body').animate
        scrollTop: target.offset().top - 170
      , 500
    e.preventDefault()

  $('.email').keypress (e) ->
    button = $('.email-signup')
    icon = button.find('i')
    regex = /\S+@\S+\.\S+/
    email = $(@)
    if (button.hasClass 'btn-primary' || button.hasClass 'btn-danger') && regex.test(email.val())
      button.removeClass 'btn-primary btn-danger'
      button.addClass 'btn-success'
      icon.removeClass 'fa-envelope fa-times'
      icon.addClass 'fa-check'

  $('.email').change (e) ->
    button = $('.email-signup')
    icon = button.find('i')
    regex = /\S+@\S+\.\S+/
    email = $(@)
    if (button.hasClass 'btn-primary' || button.hasClass 'btn-success') && !regex.test(email.val())
      button.removeClass 'btn-primary btn-success'
      button.addClass 'btn-danger'
      icon.removeClass 'fa-envelope fa-check'
      icon.addClass 'fa-times'

  $(window).scroll ->
    scrollTop = $(window).scrollTop()

    if scrollTop > 0
      $('.navbar').addClass('active')
    else
      $('.navbar').removeClass('active')

    closestSection = undefined
    closestDist = undefined
    $('.section').each ->
      dist = Math.abs($(@).offset().top - scrollTop)
      if !closestSection? || dist < closestDist
        closestSection = @
        closestDist = dist

    $('.navbar a').removeClass('active')
    findSectionById($(closestSection).attr('id')).addClass('active')

  $('.auth').addClass('active')

$(document).ready ready
$(document).on 'page:load', ready
